<mxfile host="app.diagrams.net" modified="2025-02-14T10:00:00.000Z" agent="Codex" version="24.7.7" type="device">
  <diagram id="sys-overview" name="System Overview">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="A_lane_user" value="User" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="A_lane_ui" value="UI" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="260" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="A_lane_modules" value="modules" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="A_lane_experiment" value="Experiment" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="740" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="A_lane_thunderbird" value="Thunderbird" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="980" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="A_lane_nextcloud" value="Nextcloud" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="1220" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="A_step1" value="1. User action (Options / Sharing / Talk)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_user">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="A_step2" value="2. UI scripts handle input (options.js, ui/nextcloudSharingWizard.js, ui/talkDialog.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_ui">
          <mxGeometry x="20" y="60" width="200" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="A_step3" value="3. background.js dispatches runtime messages" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_modules">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="A_step4" value="4. modules/* build requests (nccore.js, ncSharing.js, talkcore.js, ocs.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_modules">
          <mxGeometry x="20" y="160" width="200" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="A_step5" value="5. Nextcloud OCS/WebDAV responses (JSON)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_nextcloud">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="A_step6" value="6. UI applies results (status, HTML, metadata)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_ui">
          <mxGeometry x="20" y="170" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="A_step7" value="7. Thunderbird updates (compose, calendar, storage)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="A_lane_thunderbird">
          <mxGeometry x="20" y="170" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="A_exp1" value="Calendar injection (experiments/calToolbar/parent.js -> ui/calToolbarDialog.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#b0b0b0;fontColor=#555555;" vertex="1" parent="A_lane_experiment">
          <mxGeometry x="20" y="60" width="200" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="A_data1" value="auth header + payload" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="A_lane_modules">
          <mxGeometry x="20" y="270" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="A_data2" value="OCS JSON / DAV result" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="A_lane_nextcloud">
          <mxGeometry x="20" y="150" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="A_data3" value="X-NCTALK-* / HTML block" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="A_lane_thunderbird">
          <mxGeometry x="20" y="270" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="A_step1" target="A_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="A_step2" target="A_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="A_step3" target="A_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="A_step4" target="A_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="A_step5" target="A_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="A_step6" target="A_step7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge_exp" value="injects calendar button" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#7e7e7e;" edge="1" parent="1" source="A_exp1" target="A_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge_d1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="A_step4" target="A_data1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge_d2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="A_step5" target="A_data2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge_d3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="A_step6" target="A_data3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_edge_d4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="A_data3" target="A_step7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="A_err1" value="HTTP/auth error" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;dashed=1;strokeColor=#d9534f;" edge="1" parent="1" source="A_step5" target="A_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="options-auth" name="Options &amp; Auth Flow">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="B_lane_user" value="User" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="B_lane_ui" value="UI" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="260" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="B_lane_modules" value="modules" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="B_lane_experiment" value="Experiment" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="740" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="B_lane_thunderbird" value="Thunderbird" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="980" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="B_lane_nextcloud" value="Nextcloud" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="1220" y="20" width="240" height="900" as="geometry"/>
        </mxCell>

        <mxCell id="B_step1" value="1. Click Test connection or Login Flow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="B_lane_user">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="B_step2" value="2. options.js sendMessage (async)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="B_lane_ui">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="B_step3" value="3. background.js routes to NCCore" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="B_lane_modules">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="B_step4" value="4. NCCore: testCredentials / startLoginFlow (fetch)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="B_lane_modules">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="B_step5" value="5. Nextcloud OCS/login endpoints" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="B_lane_nextcloud">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="B_step6" value="6. Update status + save settings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="B_lane_ui">
          <mxGeometry x="20" y="160" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="B_exp1" value="Experiment not used" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#b0b0b0;fontColor=#555555;" vertex="1" parent="B_lane_experiment">
          <mxGeometry x="20" y="60" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="B_data1" value="options payload {baseUrl,user,appPass}" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="B_lane_ui">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="B_data2" value="Authorization: Basic ..." style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="B_lane_modules">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="B_data3" value="OCS JSON (capabilities/user)" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="B_lane_nextcloud">
          <mxGeometry x="20" y="150" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="B_data4" value="loginUrl + pollToken / appPassword" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="B_lane_nextcloud">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="B_data5" value="browser.storage.local" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="B_lane_thunderbird">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="B_edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="B_step1" target="B_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="B_step2" target="B_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="B_step3" target="B_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="B_step4" target="B_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="B_step5" target="B_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge_d1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="B_step2" target="B_data1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge_d2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="B_step4" target="B_data2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge_d3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="B_step5" target="B_data3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge_d4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="B_step5" target="B_data4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_edge_d5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="B_step6" target="B_data5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="B_err1" value="401/403 or HTTP error" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;dashed=1;strokeColor=#d9534f;" edge="1" parent="1" source="B_step5" target="B_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Sharing-flow" name="Sharing Flow">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="C_lane_user" value="User" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="C_lane_ui" value="UI" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="260" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="C_lane_modules" value="modules" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="C_lane_experiment" value="Experiment" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="740" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="C_lane_thunderbird" value="Thunderbird" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="980" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="C_lane_nextcloud" value="Nextcloud" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="1220" y="20" width="240" height="900" as="geometry"/>
        </mxCell>

        <mxCell id="C_step1" value="1. Click ComposeAction (Add Nextcloud Share)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_user">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="C_step2" value="2. background.js opens ui/nextcloudSharingWizard.html" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_modules">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="C_step3" value="3. nextcloudSharingWizard.js collects files/settings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_ui">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="C_step4" value="4. ncSharing.js create share (DAV + OCS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_modules">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="C_step5" value="5. WebDAV + OCS responses" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_nextcloud">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="C_step6" value="6. Build HTML + send sharing:insertHtml" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_ui">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="C_step7" value="7. compose.setComposeDetails inserts HTML" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="C_lane_thunderbird">
          <mxGeometry x="20" y="160" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="C_exp1" value="Experiment not used" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#b0b0b0;fontColor=#555555;" vertex="1" parent="C_lane_experiment">
          <mxGeometry x="20" y="60" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="C_data1" value="files[] + permissions + expire/password" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="C_lane_ui">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="C_data2" value="DAV path + auth header" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="C_lane_modules">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="C_data3" value="share JSON {url, token, id}" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="C_lane_nextcloud">
          <mxGeometry x="20" y="150" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="C_data4" value="HTML block" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="C_lane_ui">
          <mxGeometry x="20" y="320" width="200" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="C_edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="C_step1" target="C_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="C_step2" target="C_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="C_step3" target="C_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="C_step4" target="C_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="C_step5" target="C_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="C_step6" target="C_step7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge_d1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="C_step3" target="C_data1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge_d2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="C_step4" target="C_data2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge_d3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="C_step5" target="C_data3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_edge_d4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="C_step6" target="C_data4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="C_err1" value="upload/OCS error" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;dashed=1;strokeColor=#d9534f;" edge="1" parent="1" source="C_step5" target="C_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="talk-flow" name="Talk Flow">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="D_lane_user" value="User" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="D_lane_ui" value="UI" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="260" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="D_lane_modules" value="modules" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="D_lane_experiment" value="Experiment" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="740" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="D_lane_thunderbird" value="Thunderbird" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="980" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="D_lane_nextcloud" value="Nextcloud" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="1220" y="20" width="240" height="900" as="geometry"/>
        </mxCell>

        <mxCell id="D_step1" value="1. Click Nextcloud Talk button" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_user">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="D_step2" value="2. ui/talkDialog.js requests event snapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_ui">
          <mxGeometry x="20" y="60" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="D_step3" value="3. calToolbar.invokeWindow getEventSnapshot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_experiment">
          <mxGeometry x="20" y="60" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="D_step4" value="4. User clicks Create -> talk:createRoom" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_ui">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="D_step5" value="5. talkcore.js capabilities + create room (OCS)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_modules">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="D_step6" value="6. OCS response: room token + url" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_nextcloud">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="D_step7" value="7. invokeWindow setTalkMetadata/applyEventFields" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_experiment">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="D_step8" value="8. calendar item updated (X-NCTALK-*)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="D_lane_thunderbird">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="D_data1" value="event snapshot {title, description}" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="D_lane_experiment">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="D_data2" value="create payload + auth header" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="D_lane_modules">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="D_data3" value="room token/url + description block" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="D_lane_nextcloud">
          <mxGeometry x="20" y="150" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="D_data4" value="calendarItem properties" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="D_lane_thunderbird">
          <mxGeometry x="20" y="250" width="200" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="D_edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step1" target="D_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step2" target="D_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step3" target="D_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step4" target="D_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step5" target="D_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step6" target="D_step7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="D_step7" target="D_step8">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge_d1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="D_step3" target="D_data1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge_d2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="D_step5" target="D_data2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge_d3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="D_step6" target="D_data3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_edge_d4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="D_step7" target="D_data4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="D_err1" value="create failed / unsupported" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;dashed=1;strokeColor=#d9534f;" edge="1" parent="1" source="D_step5" target="D_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="calendar-flow" name="Calendar Integration Flow">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="E_lane_user" value="User" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="E_lane_ui" value="UI" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="260" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="E_lane_modules" value="modules" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="E_lane_experiment" value="Experiment" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="740" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="E_lane_thunderbird" value="Thunderbird" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="980" y="20" width="240" height="900" as="geometry"/>
        </mxCell>
        <mxCell id="E_lane_nextcloud" value="Nextcloud" style="swimlane;html=1;horizontal=0;startSize=30;fillColor=#f8f8f8;strokeColor=#c0c0c0;" vertex="1" parent="1">
          <mxGeometry x="1220" y="20" width="240" height="900" as="geometry"/>
        </mxCell>

        <mxCell id="E_step1" value="1. background.js calls browser.calToolbar.init" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_modules">
          <mxGeometry x="20" y="60" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_step2" value="2. experiments/calToolbar/parent.js registers listeners" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_experiment">
          <mxGeometry x="20" y="60" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_step3" value="3. Event dialog window opens" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_thunderbird">
          <mxGeometry x="20" y="60" width="200" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="E_step4" value="4. Inject ui/calToolbarDialog.js + ui/calToolbarShared.js" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_experiment">
          <mxGeometry x="20" y="160" width="200" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="E_step5" value="5. calToolbarDialog.js injects toolbar button" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_ui">
          <mxGeometry x="20" y="60" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_step6" value="6. User clicks button -> NCTalkBridge.openDialog" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_ui">
          <mxGeometry x="20" y="160" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_step7" value="7. NCTalkCalUtils read/write fields" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_experiment">
          <mxGeometry x="20" y="260" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_step8" value="8. calendarItem.setProperty X-NCTALK-*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="E_lane_thunderbird">
          <mxGeometry x="20" y="260" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_next1" value="Nextcloud updates via observers (talkcore.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#eeeeee;strokeColor=#b0b0b0;fontColor=#555555;" vertex="1" parent="E_lane_nextcloud">
          <mxGeometry x="20" y="360" width="200" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="E_data1" value="windowId" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="E_lane_experiment">
          <mxGeometry x="20" y="340" width="200" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="E_data2" value="calendarItem properties" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="E_lane_thunderbird">
          <mxGeometry x="20" y="340" width="200" height="50" as="geometry"/>
        </mxCell>

        <mxCell id="E_edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step1" target="E_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step2" target="E_step3">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step3" target="E_step4">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step4" target="E_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step5" target="E_step6">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step6" target="E_step7">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;" edge="1" parent="1" source="E_step7" target="E_step8">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge_d1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="E_step4" target="E_data1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge_d2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="E_step8" target="E_data2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_edge_d3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;strokeColor=#a0a0a0;" edge="1" parent="1" source="E_step8" target="E_next1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="E_err1" value="inject failed" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;dashed=1;strokeColor=#d9534f;" edge="1" parent="1" source="E_step4" target="E_step5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>


